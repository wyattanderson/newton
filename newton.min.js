!function(a){"use strict";function b(a,c,d,e,f){return this instanceof b?(this.axis=c,this.p1=a,this.p2=d,this.angle="undefined"==typeof f?this.getAngle():f,this.stiffness=e||1,this.isDestroyed=!1,void 0):new b(a,c,d,e,f)}Math.PI,2*Math.PI;b.prototype.category="angular",b.prototype.priority=6,b.prototype.getAngle=function(){var a=this.p1.position.pool().sub(this.axis.position),b=this.p2.position.pool().sub(this.axis.position),c=a.getAngleTo(b);return a.free(),b.free(),c},b.prototype.resolve=function(){if(this.p1.isDestroyed||this.p2.isDestroyed||this.axis.isDestroyed)return this.isDestroyed=!0,void 0;var a=this.angle-this.getAngle();a<=-Math.PI?a+=2*Math.PI:a>=Math.PI&&(a-=2*Math.PI),a*=-.25*this.stiffness,this.p1.pinned||this.p1.position.rotateAbout(this.axis.position,a),this.p2.pinned||this.p2.position.rotateAbout(this.axis.position,-a),this.axis.pinned||(this.axis.position.rotateAbout(this.p1.position,a),this.axis.position.rotateAbout(this.p2.position,-a))},a.AngleConstraint=b}("undefined"==typeof exports?this.Newton=this.Newton||{}:exports),function(a){"use strict";function b(c,d,e,f,g){return this instanceof b?(this.rect=a.Rectangle(c,d,e,f),this.particles=g,void 0):new b(c,d,e,f,g)}b.prototype.category="boxconstraint",b.prototype.priority=0,b.prototype.addTo=function(a){a.addConstraints([this])},b.prototype.resolve=function(a,b){for(var c=this.particles||b,d=-1,e=c.length;++d<e;)c[d].contain(this.rect)},a.BoxConstraint=b}("undefined"==typeof exports?this.Newton=this.Newton||{}:exports),function(a){"use strict";function b(a,c,d,e){return this instanceof b?(this.p1=a,this.p2=c,this.stiffness=d||1,this.distance="undefined"==typeof e?this.getDistance():e,this.isDestroyed=!1,void 0):new b(a,c,d,e)}b.prototype.category="linear",b.prototype.priority=4,b.prototype.getDistance=function(){return a.Vector.getDistance(this.p1.position,this.p2.position)},b.prototype.resolve=function(){if(this.p1.isDestroyed||this.p2.isDestroyed)return this.isDestroyed=!0,void 0;var a=this.p1.position,b=this.p2.position,c=b.pool().sub(a),d=c.getLength(),e=1/this.p1.getMass(),f=1/this.p2.getMass(),g=(d-this.distance)/(d*(e+f))*this.stiffness,h=c.pool().scale(g*e),i=c.scale(-g*f);this.p1.correct(h),this.p2.correct(i),c.free(),h.free()},b.prototype.getCoords=function(){return{x1:this.p1.position.x,y1:this.p1.position.y,x2:this.p2.position.x,y2:this.p2.position.y}},a.DistanceConstraint=b}("undefined"==typeof exports?this.Newton=this.Newton||{}:exports),function(a){"use strict";function b(a,c){return this instanceof b?(this.particles=a,this.deltas=this.getDeltas(),void 0):new b(a,c)}b.prototype.category="",b.prototype.priority=2,b.prototype.getCenterMass=function(){for(var b=-1,c=this.particles.length,d=a.Vector(0,0);++b<c;)d.add(this.particles[b].position);return d.scale(1/c),d},b.prototype.getDeltas=function(){for(var a=this.getCenterMass(),b=-1,c=this.particles.length,d=Array(c);++b<c;)d[b]=this.particles[b].position.clone().sub(a);return d},b.prototype.resolve=function(){for(var a=this.getCenterMass(),b=0,c=-1,d=this.particles.length;++c<d;){var e=this.particles[c].position.clone().sub(a),f=this.deltas[c];b+=e.getAngleTo(f)}for(b/=d,c=-1;++c<d;){var g=this.deltas[c].clone().rotateBy(-b).add(a),h=g.sub(this.particles[c].position);this.particles[c].position.add(h.scale(.5))}},a.RigidConstraint=b}("undefined"==typeof exports?this.Newton=this.Newton||{}:exports),function(a){"use strict";function b(a,b){return(a%b+b)%b}function c(b,d,e,f,g){return this instanceof c?(this.rect=a.Rectangle(b,d,e,f),this.particles=g,this.layer=void 0,void 0):new c(b,d,e,f,g)}c.prototype.category="WrapConstraint",c.prototype.priority=0,c.prototype.addTo=function(a,b){a.addConstraints([this]),this.layer=b},c.prototype.resolve=function(a,c){for(var d,e,f=this.particles||c,g=-1,h=f.length,i=this.rect;++g<h;)if(e=f[g].position,e.x<i.left||e.x>i.right||e.y<i.top||e.y>i.bottom){d=f[g];var j=b(d.position.x,this.rect.width)+this.rect.left,k=b(d.position.y,this.rect.height)+this.rect.top;d.shiftTo(j,k)}},a.WrapConstraint=c}("undefined"==typeof exports?this.Newton=this.Newton||{}:exports),function(a){"use strict";function b(a){return this instanceof b?(this.particles=[],this.edges=[],this.constraints=[],this.material=a,this.simulator=void 0,this.layer=void 0,this.isFree=!1,void 0):new b(a)}b.prototype.addTo=function(a,b){if(this.simulator)throw new Error("Not implemented: reparenting a body");a.addParticles(this.particles),a.addEdges(this.edges),a.addConstraints(this.constraints),this.simulator=a,this.layer=b;for(var c=0,d=this.particles.length;d>c;c++)this.particles[c].layer=b;for(var c=0,d=this.edges.length;d>c;c++)this.edges[c].layer=b},b.prototype.free=function(){this.isFree=!0,this.simulator&&this.simulator.addCollisionParticles(this.particles)},b.prototype.addParticle=function(a){this.particles.push(a),a.layer=this.layer,this.simulator&&(this.simulator.addParticles([a]),this.isFree&&this.simulator.addCollisionParticles([a]))},b.prototype.Particle=function(){var b=a.Particle.apply(a.Particle,Array.prototype.slice.call(arguments));return this.addParticle(b),b},b.prototype.addEdge=function(a){this.edges.push(a),a.layer=this.layer,this.simulator&&this.simulator.addEdges([a])},b.prototype.Edge=function(){var b=a.Edge.apply(a.Edge,Array.prototype.slice.call(arguments));return this.addEdge(b),b},b.prototype.addConstraint=function(a){this.constraints.push(a),this.simulator&&this.simulator.addConstraints([a])},b.prototype.DistanceConstraint=function(){var b=a.DistanceConstraint.apply(a.DistanceConstraint,Array.prototype.slice.call(arguments));return this.addConstraint(b),b},b.prototype.RigidConstraint=function(){var b=a.RigidConstraint.apply(a.RigidConstraint,Array.prototype.slice.call(arguments));return this.addConstraint(b),b},b.prototype.AngleConstraint=function(){var b=a.AngleConstraint.apply(a.AngleConstraint,Array.prototype.slice.call(arguments));return this.addConstraint(b),b},a.Body=b}("undefined"==typeof exports?this.Newton=this.Newton||{}:exports),function(a){"use strict";function b(c,d,e){return this instanceof b?(this.p1=c,this.p2=d,this.material=e||a.Material.simple,this.compute(),this._rect=new a.Rectangle(0,0,0,0),this.layer=void 0,this.isDestroyed=!1,void 0):new b(c,d,e)}b.COLLISION_TOLERANCE=.5,b.getAbc=function(a,b,c,d){var e=d-b,f=a-c,g=e*a+f*b;return{a:e,b:f,c:g}},b.prototype.compute=function(){this.anchor=this.p1.position.clone(),this.vector=this.p2.position.clone().sub(this.p1.position),this.length=this.vector.getLength(),this.angle=this.vector.getAngle(),this.normal=this.vector.clone().turnLeft().unit(),this.unit=this.vector.clone().unit(),this.bounds=a.Rectangle.fromVectors(this.p1.position,this.p2.position).expand(b.COLLISION_TOLERANCE)},b.prototype.getCoords=function(){return{x1:this.p1.position.x,y1:this.p1.position.y,x2:this.p2.position.x,y2:this.p2.position.y}},b.prototype.getProjection=function(a){var b=this.vector.getDot(a);return this.unit.clone().scale(b)},b.prototype.getAngleDelta=function(a){return this.angle-a.getAngle()},b.prototype.getAbc=function(){return b.getAbc(this.p1.position.x,this.p1.position.y,this.p2.position.x,this.p2.position.y)},b.prototype.findIntersection=function(c,d){var e=c.x,f=c.y,g=d.x,h=d.y,i=a.Vector.scratch.set(g-e,h-f).getDot(this.normal);if(i>=0)return!1;var j=this.bounds,k=this._rect.set(e,f,g,h).expand(b.COLLISION_TOLERANCE);if(!j.overlaps(k))return!1;var l=this.getAbc(),m=b.getAbc(e,f,g,h),n=l.a*m.b-m.a*l.b;if(0===n)return!1;var o=(m.b*l.c-l.b*m.c)/n,p=(l.a*m.c-m.a*l.c)/n;if(!j.contains(o,p)||!k.contains(o,p))return!1;var q=o-e,r=p-f;return{x:o,y:p,dx:q,dy:r,distance:q*q+r*r,wall:this}},b.prototype.getReflection=function(a,b){var c=this.normal.clone(),d=this.material.friction,e=c.scale(a.getDot(c)).scale(b),f=a.clone().sub(e).scale(1-d),g=f.sub(e);return g},b.prototype.destroy=function(){this.isDestroyed=!0},a.Edge=b}("undefined"==typeof exports?this.Newton=this.Newton||{}:exports),function(a){"use strict";function b(a){var b=(new Date).getTime(),c=Math.max(0,16-(b-d)),e=setTimeout(function(){a(b+c)},c);return d=b+c,e}function c(a){clearTimeout(a)}var d=0;if("undefined"!=typeof window){for(var e=["ms","moz","webkit","o"],f=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,g=(Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,!!window.chrome&&!f,0);g<e.length&&!window.requestAnimationFrame;++g)window.requestAnimationFrame=window[e[g]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[g]+"CancelAnimationFrame"]||window[e[g]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=b,window.cancelAnimationFrame=c),a.frame=window.requestAnimationFrame.bind(window),a.cancelFrame=window.cancelAnimationFrame.bind(window)}else a.frame=b,a.cancelFrame=c}("undefined"==typeof exports?this.Newton=this.Newton||{}:exports),function(a){"use strict";function b(a){return this instanceof b?(a=a||{},this.weight=a.weight||1,this.restitution=a.restitution||1,this.friction=a.friction||0,this.maxVelocity=a.maxVelocity||100,this.maxVelocitySquared=this.maxVelocity*this.maxVelocity,void 0):new b(a)}b.prototype.setMaxVelocity=function(a){return this.maxVelocity=a,this.maxVelocitySquared=a*a,this},b.simple=new b,a.Material=b}("undefined"==typeof exports?this.Newton=this.Newton||{}:exports),function(a){"use strict";function b(c,d,e,f){return this instanceof b?(this.position=new a.Vector(c,d),this.lastPosition=this.position.clone(),this.lastValidPosition=this.position.clone(),this.velocity=new a.Vector(0,0),this.acceleration=new a.Vector(0,0),this.material=f||a.Material.simple,this.size=e||1,this.randomDrag=0,this.pinned=!1,this.colliding=!1,this.isDestroyed=!1,this.layer=void 0,void 0):new b(c,d,e,f)}b.randomness=25,b.prototype.integrate=function(a){if(!this.pinned){this.velocity.copy(this.position).sub(this.lastPosition);var b=Math.min(1,this.velocity.getLength2()/(this.material.maxVelocitySquared+this.randomDrag));this.velocity.scale(1-b),this.acceleration.scale(1-b).scale(a*a),this.lastPosition.copy(this.position),this.position.add(this.velocity).add(this.acceleration),this.acceleration.zero(),this.lastValidPosition.copy(this.lastPosition),this.colliding=!1}},b.prototype.placeAt=function(a,b){return this.position.set(a,b),this.lastPosition.copy(this.position),this.lastValidPosition.copy(this.lastPosition),this},b.prototype.correct=function(a){this.pinned||this.position.add(a)},b.prototype.moveTo=function(a,b){return this.position.set(a,b),this},b.prototype.shiftTo=function(a,b){var c=a-this.position.x,d=b-this.position.y;this.position.addXY(c,d),this.lastValidPosition.addXY(c,d),this.lastPosition.addXY(c,d)},b.prototype.destroy=function(){this.isDestroyed=!0},b.prototype.getDistance=function(a,b){return this.position.pool().subXY(a,b).getLength()},b.prototype.pin=function(a,b){a="undefined"!=typeof a?a:this.position.x,b="undefined"!=typeof b?b:this.position.y,this.placeAt(a,b),this.pinned=!0,this.size=1/0},b.prototype.setVelocity=function(a,b){return this.lastPosition.copy(this.position).subXY(a,b),this},b.prototype.contain=function(a){this.position.x>a.right?this.position.x=this.lastPosition.x=this.lastValidPosition.x=a.right:this.position.x<a.left&&(this.position.x=this.lastPosition.x=this.lastValidPosition.x=a.left),this.position.y>a.bottom?this.position.y=this.lastPosition.y=this.lastValidPosition.y=a.bottom:this.position.y<a.top&&(this.position.y=this.lastPosition.y=this.lastValidPosition.y=a.top)},b.prototype.applyForce=function(a){this.accelerateVector(a.vector)},b.prototype.accelerateVector=function(a){this.acceleration.add(a)},b.prototype.force=function(a,b,c){c=c||this.getMass(),this.acceleration.add({x:a/c,y:b/c})},b.prototype.getMass=function(){return this.size*this.material.weight},b.prototype.getSquaredSpeed=function(){return this.velocity.getSquaredLength()},b.prototype.attractSquare=function(b,c,d,e){var f=this.getMass(),g=(new a.Vector.claim).set(b,c).sub(this.position),h=Math.max(g.getLength(),e||1),i=d*f/(h*h),j=d/(d+f);this.acceleration.add({x:-i*(g.x/h)*j,y:-i*(g.y/h)*j}),g.free()},b.prototype.collide=function(b){var c=this.position.pool().sub(this.lastPosition),d=a.Vector.claim().set(b.x,b.y).add(b.wall.normal),e=b.wall.getReflection(c,this.material.restitution);this.position.copy(d),this.setVelocity(e.x,e.y),this.lastValidPosition=d,this.colliding=!0,c.free(),d.free()},a.Particle=b}("undefined"==typeof exports?this.Newton=this.Newton||{}:exports),function(a){"use strict";function b(){}function c(a,b){return b.priority-a.priority}function d(a,c,e,f){return this instanceof d?(this.callback=a||b,this.renderers=c||b,Array.isArray(this.renderers)||(this.renderers=[this.renderers]),this.step=this._step.bind(this),this.lastTime=0,this.running=!1,this.fps=0,this.frames=0,this.countTime=0,this.countInterval=250,this.accumulator=0,this.simulationStep=1e3/(e||60),this.iterations=f||3,this.startTime=0,this.layers={},this.particles=[],this.edges=[],this.forces=[],this.constraints=[],this.collisionParticles=[],void 0):new d(a,c,e,f)}Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),d.prototype.start=function(){this.running=!0,this.countTime=Date.now()+1e3,this.startTime=Date.now(),a.frame(this.step)},d.prototype.stop=function(){this.running=!1},d.prototype._step=function(){if(this.running){var b=Date.now(),c=b-this.lastTime;for(this.lastTime=b,c>100&&(c=0),this.accumulator+=c;this.accumulator>=this.simulationStep;)this.simulate(this.simulationStep,b-this.startTime),this.accumulator-=this.simulationStep;for(var d=0;d<this.renderers.length;d++)this.renderers[d](c,this);this.frames++,b>=this.countTime&&(this.fps=(this.frames/(this.countInterval+b-this.countTime)*1e3).toFixed(0),this.frames=0,this.countTime=b+this.countInterval),a.frame(this.step)}},d.prototype.simulate=function(a,b){this.cull(this.particles),this.cull(this.constraints),this.cull(this.edges),this.callback(a,this,b),this.integrate(a),this.constrain(a),this.updateEdges(),this.collide(a)},d.prototype.cull=function(a){for(var b=0;b<a.length;)a[b].isDestroyed?a.splice(b,1):b++},d.prototype.integrate=function(a){for(var b,c,d,e=this.particles,f=this.forces,g=this.layers,h=[],i=0,j=e.length;j>i;i++){if(b=e[i],d=b.layer?g[b.layer].linked:h,!b.pinned)for(var k=0,l=f.length;l>k;k++)c=f[k],c.layer&&-1===d.indexOf(c.layer)||c.applyTo(b);b.integrate(a)}},d.prototype.constrain=function(a){for(var b=this.constraints,c=0,d=this.iterations;d>c;c++)for(var e=0,f=b.length;f>e;e++)b[e].resolve(a,this.particles)},d.prototype.updateEdges=function(){for(var a=0,b=this.edges.length;b>a;a++)this.edges[a].compute()},d.prototype.collide=function(){for(var a,b,c,d,e,f=this.collisionParticles,g=this.edges,h=this.layers,i=[],j=0,k=f.length;k>j;j++){b=f[j],e=b.layer?h[b.layer].linked:i,a=void 0,d=void 0;for(var l=0,m=g.length;m>l;l++)c=g[l],c.layer&&-1===e.indexOf(c.layer)||b!==c.p1&&b!==c.p2&&(a=c.findIntersection(b.lastPosition,b.position),a&&(!d||a.distance<d.distance)&&(d=a));d&&b.collide(d)}},d.prototype.ensureLayer=function(a){a&&(this.layers[a]||(this.layers[a]={linked:[a]}))},d.prototype.add=function(a,b){var c=Array.isArray(a)?a:[a];for(this.ensureLayer(b);c.length;)c.shift().addTo(this,b);return this},d.prototype.link=function(a,b){return this.ensureLayer(a),this.layers[a].linked=b.split(" "),this},d.prototype.addParticles=function(a){this.particles.push.apply(this.particles,a)},d.prototype.addEdges=function(a){this.edges.push.apply(this.edges,a);for(var b=0;b<a.length;b++)this.addCollisionParticles([a[b].p1,a[b].p2])},d.prototype.addCollisionParticles=function(a){for(var b=a.length;b--;)-1===this.collisionParticles.indexOf(a[b])&&this.collisionParticles.push(a[b]);return this},d.prototype.addConstraints=function(a){this.constraints.push.apply(this.constraints,a),this.constraints.sort(c)},d.prototype.findParticle=function(a,b,c){for(var d,e=this.particles,f=void 0,g=c,h=0,i=e.length;i>h;h++)d=e[h].getDistance(a,b),g>=d&&(f=e[h],g=d);return f},d.prototype.addBody=function(a){this.particles.push.apply(this.particles,a.particles),this.edges.push.apply(this.edges,a.edges),this.bodies.push(a)},d.prototype.Layer=function(){var b=a.Layer();return this.layers.push(b),b},a.Simulator=d}("undefined"==typeof exports?this.Newton=this.Newton||{}:exports),function(a){"use strict";function b(b,c,d){var e=a.Body(),f=e.Particle(b-d,c-d),g=e.Particle(b+d,c-d),h=e.Particle(b-d,c+d),i=e.Particle(b+d,c+d);return e.DistanceConstraint(f,g),e.DistanceConstraint(g,i),e.DistanceConstraint(i,h),e.DistanceConstraint(h,f),e.DistanceConstraint(f,i),e.DistanceConstraint(g,h),e.Edge(f,g),e.Edge(g,i),e.Edge(i,h),e.Edge(h,f),e}a.Box=b}("undefined"==typeof exports?this.Newton=this.Newton||{}:exports),function(a){"use strict";function b(b,c,d,e,f,g){for(var h,i=(d-b)/f,j=a.Body(),k=0;f>k;k++)for(var l=0;g>l;l++)h=j.Particle(b+k*i,c+l*i),0===l&&h.pin();for(var k=0;f>k;k++)for(var l=0;g>l;l++)l>0&&j.DistanceConstraint(j.particles[k*g+l],j.particles[k*g+l-1],.2),k>0&&j.DistanceConstraint(j.particles[k*g+l],j.particles[k*g+l-g],.2),0===k&&l>0&&j.Edge(j.particles[k*g+l],j.particles[k*g+l-1]),l===g-1&&k>0&&j.Edge(j.particles[k*g+l],j.particles[k*g+l-g]),k===f-1&&l>0&&j.Edge(j.particles[k*g+l-1],j.particles[k*g+l]);return j}a.Fabric=b}("undefined"==typeof exports?this.Newton=this.Newton||{}:exports),function(a){"use strict";function b(b,c,d,e,f,g){var h=a.Body(),i=h.Particle(b,c),j=h.Particle(b,c+d);f&&(i.pin(),j.pin());for(var k=1;e>=k;k++){var l=h.Particle(b+k*d,c),m=h.Particle(b+k*d,c+d);h.DistanceConstraint(i,l),h.DistanceConstraint(j,m),h.DistanceConstraint(i,m),h.DistanceConstraint(l,j),h.DistanceConstraint(l,m),h.Edge(i,l),h.Edge(j,m),k===e&&h.Edge(l,m),i=l,j=m}return g&&(i.pin(),j.pin()),h}a.Lattice=b}("undefined"==typeof exports?this.Newton=this.Newton||{}:exports),function(a){"use strict";function b(b,c,d,e){for(var f=2*Math.PI/e,g=a.Body(),h=0;e>h;h++){var i=b+d*Math.cos(h*f-.5*Math.PI),j=c+d*Math.sin(h*f-.5*Math.PI);g.Particle(i,j);for(var k=0;h>k;k++)g.DistanceConstraint(g.particles[h],g.particles[k],.002);h>0&&g.Edge(g.particles[h-1],g.particles[h])}return g.Edge(g.particles[e-1],g.particles[0]),g}a.Squishy=b}("undefined"==typeof exports?this.Newton=this.Newton||{}:exports),function(a){"use strict";function b(c,d,e){return this instanceof b?(this.angle=c,this.strength=d,this.vector=new a.Vector(0,d).rotateBy(c),this.simulator=void 0,this.layer=void 0,void 0):new b(c,d,e)}b.prototype.addTo=function(a,b){a.forces.push(this),this.simulator=a,this.layer=b},b.prototype.setAngle=function(a){this.angle=a,this.vector.set(0,this.strength).rotateBy(this.angle)},b.prototype.setStrength=function(a){this.strength=a,this.vector.set(0,this.strength).rotateBy(this.angle)},b.prototype.applyTo=function(a){a.accelerateVector(this.vector)},a.LinearGravity=b}("undefined"==typeof exports?this.Newton=this.Newton||{}:exports),function(a){"use strict";function b(a,c,d,e){return this instanceof b?(this.x=a,this.y=c,this.strength=d,this.simulator=void 0,this.layer=void 0,void 0):new b(a,c,d,e)}b.prototype.addTo=function(a,b){a.forces.push(this),this.simulator=a,this.layer=b},b.prototype.setLocation=function(a,b){this.x=a,this.y=b},b.prototype.setStrength=function(a){this.strength=a},b.prototype.applyTo=function(a){a.attractSquare(this.x,this.y,this.strength,20)},a.RadialGravity=b}("undefined"==typeof exports?this.Newton=this.Newton||{}:exports),function(a){"use strict";function b(a,c,d,e){return this instanceof b?(this.set.apply(this,arguments),void 0):new b(a,c,d,e)}b.fromVectors=function(a,c){return new b(a.x,a.y,c.x,c.y)},b.prototype={set:function(a,b,c,d){return this.left=Math.min(a,c),this.top=Math.min(b,d),this.right=Math.max(c,a),this.bottom=Math.max(d,b),this.width=this.right-this.left,this.height=this.bottom-this.top,this},contains:function(a,b){return a>=this.left&&a<=this.right&&b>=this.top&&b<=this.bottom},overlaps:function(a){return!(a.left>this.right||a.right<this.left||a.top>this.bottom||a.bottom<this.top)},expand:function(a){return this.left-=a,this.right+=a,this.top-=a,this.bottom+=a,this}},a.Rectangle=b}("undefined"==typeof exports?this.Newton=this.Newton||{}:exports),function(a){"use strict";function b(a,c){return this instanceof b?(this.x=a,this.y=c,void 0):new b(a,c)}b._pool=[],b.pool=function(c){if("undefined"==typeof c)return b._pool.length;b._pool.length=0;for(var d=0;c>d;d++)b._pool.push(a.Vector())},b.claim=function(){return b._pool.pop()||a.Vector()},b.prototype.free=function(){return b._pool.push(this),this},b.prototype.pool=function(){return b.claim().copy(this)},b.scratch=new b,b.getDistance=function(a,b){var c=a.x-b.x,d=a.y-b.y;return Math.sqrt(c*c+d*d)},b.prototype.clone=function(){return a.Vector(this.x,this.y)},b.prototype.copy=function(a){return this.x=a.x,this.y=a.y,this},b.prototype.zero=function(){return this.x=0,this.y=0,this},b.prototype.set=function(a,b){return this.x=a,this.y=b,this},b.prototype.add=function(a){return this.x+=a.x,this.y+=a.y,this},b.prototype.addXY=function(a,b){return this.x+=a,this.y+=b,this},b.prototype.sub=function(a){return this.x-=a.x,this.y-=a.y,this},b.prototype.subXY=function(a,b){return this.x-=a,this.y-=b,this},b.prototype.mult=function(a){return this.x*=a.x,this.y*=a.y,this},b.prototype.scale=function(a){return this.x*=a,this.y*=a,this},b.prototype.div=function(a){return this.x/=a.x,this.y/=a.y,this},b.prototype.reverse=function(){return this.x=-this.x,this.y=-this.y,this},b.prototype.unit=function(){return this.scale(1/this.getLength()),this},b.prototype.turnRight=function(){var a=this.x,b=this.y;return this.x=-b,this.y=a,this},b.prototype.turnLeft=function(){var a=this.x,b=this.y;return this.x=b,this.y=-a,this},b.prototype.rotateBy=function(a){var b=this.x,c=-this.y,d=Math.sin(a),e=Math.cos(a);return this.x=b*e-c*d,this.y=-(b*d+c*e),this},b.prototype.rotateAbout=function(a,b){return this.sub(a).rotateBy(b).add(a),this},b.prototype.getDot=function(a){return this.x*a.x+this.y*a.y},b.prototype.getCross=function(a){return this.x*a.y+this.y*a.x},b.prototype.getLength=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},b.prototype.getLength2=function(){return this.x*this.x+this.y*this.y},b.prototype.getAngle=function(){return Math.atan2(-this.y,this.x)},b.prototype.getAngleTo=function(a){var b=this.x*a.x+this.y*a.y,c=this.y*a.x-this.x*a.y;return Math.atan2(c,b)},a.Vector=b}("undefined"==typeof exports?this.Newton=this.Newton||{}:exports),function(a){"use strict";function b(a,b,c){return(1<<24)+(a<<16)+(b<<8)+c}function c(a,b,d){return this instanceof c?(this.stage=new PIXI.Stage(0,!0),this.stage.setInteractive(!0),this.width=b,this.height=d,this.renderer=PIXI.autoDetectRenderer(this.width,this.height,null,!1,!0),this.renderer.view.style.display="block",a.appendChild(this.renderer.view),this.infoText=new PIXI.Text("FPS: ??",{fill:"#ffffff",font:"10pt Helvetica"}),this.stage.addChild(this.infoText),this.graphics=new PIXI.Graphics,this.stage.addChild(this.graphics),this.callback=this.callback.bind(this),void 0):new c(a,b,d)}c.prototype={callback:function(a,b){var c=0,d=0;this.graphics.clear();for(var e=0,f=b.layers.length;f>e;e++){for(var g=0,h=b.layers[e].bodies.length;h>g;g++)c+=this.drawParticles(b.layers[e].bodies[g].particles),d+=this.drawEdges(b.layers[e].bodies[g].edges);this.drawForces(b.layers[e].forces)}this.infoText.setText("FPS: "+b.fps+"\nparticles: "+c+"\nedges: "+d),this.renderer.render(this.stage)},drawForces:function(b){this.graphics.lineStyle(2,16777215,.3);for(var c=0,d=b.length;d>c;c++){var e=b[c];e instanceof a.RadialGravity&&(this.graphics.beginFill(16777215,.2),this.graphics.drawCircle(e.x,e.y,e.strength*e.strength*.5),this.graphics.endFill())}},drawParticles:function(a){for(var c,d,e,f,g,h=0,i=a.length;i>h;h++)c=a[h],d=c.position,e=c.lastValidPosition,f=c.getMass(),g=~~((f-1)/5*128),c.colliding?this.graphics.lineStyle(f,b(255,255,100),1):this.graphics.lineStyle(f,b(255,28+g,108+g),1),this.graphics.moveTo(e.x-1,e.y),this.graphics.lineTo(d.x+1,d.y);return a.length},drawEdges:function(a){this.graphics.lineStyle(1,16777215,.5);for(var b,c=a.length;c--;)b=a[c].getCoords(),this.graphics.moveTo(b.x1,b.y1),this.graphics.lineTo(b.x2,b.y2);return a.length}},a.PixiRenderer=c}("undefined"==typeof exports?this.Newton=this.Newton||{}:exports),function(a){"use strict";function b(a){return this instanceof b?(this.ctx=a.getContext("2d"),this.width=a.width,this.height=a.height,this.callback=this.callback.bind(this),void 0):new b(a)}b.prototype={callback:function(a,b){var c=this.ctx;this.clear(c,a),this.drawConstraints(c,b.constraints),this.drawEdges(c,b.edges),this.drawParticles(c,b.particles),this.drawForces(c,b.forces),this.drawCounts(c,{particles:b.particles.length,edges:b.edges.length,forces:b.forces.length,constraints:b.constraints.length}),this.drawFPS(c,b)},clear:function(a){a.save(),a.fillStyle="#000000",a.fillRect(0,0,this.width,this.height),a.restore()},drawForces:function(b,c){b.save(),b.lineWidth=2,b.strokeStyle="rgba(255, 255, 255, 0.25)",b.fillStyle="rgba(255, 255, 255, 0.15)";for(var d=0,e=c.length;e>d;d++){var f=c[d];f instanceof a.RadialGravity&&(b.beginPath(),b.arc(f.x,f.y,f.strength*f.strength*.5,0,2*Math.PI,!1),b.fill())}b.restore()},drawParticles:function(a,b){var c,d,e,f;a.save(),a.lineCap="round",a.lineJoin="round";for(var g=0,h=b.length;h>g;g++)c=b[g],d=c.position,e=c.lastValidPosition,f=c.getMass(),a.beginPath(),c.pinned?(a.strokeStyle="rgba(255, 255, 255, 1)",a.lineWidth=1,a.moveTo(e.x-3,e.y-3),a.lineTo(e.x+3,e.y+3),a.moveTo(e.x+3,e.y-3),a.lineTo(e.x-3,e.y+3)):(a.lineWidth=~~(f/3)+2,a.strokeStyle=c.colliding?"rgba(255, 255, 100, 1)":"rgba(255, 28, 108, 1)",a.moveTo(e.x,e.y),a.lineTo(d.x+1,d.y)),a.stroke();a.restore()},drawConstraints:function(a,b){var c,d;a.save(),a.strokeStyle="rgba(100, 100, 255, 1)",a.lineWidth=1;for(var e=0,f=b.length;f>e;e++)d=b[e],"linear"===d.category?(c=d.getCoords(),a.beginPath(),a.moveTo(c.x1,c.y1),a.lineTo(c.x2,c.y2),a.closePath(),a.stroke()):"rigid"===d.category&&(c=d.centerMass,a.beginPath(),a.moveTo(c.x-3,c.y-3),a.lineTo(c.x+3,c.y+3),a.closePath(),a.stroke());a.restore()},drawEdges:function(a,b){a.save(),a.strokeStyle="rgba(255, 255, 255, 0.4)",a.lineWidth=1;for(var c,d=b.length;d--;)c=b[d].getCoords(),a.beginPath(),a.moveTo(c.x1,c.y1),a.lineTo(c.x2,c.y2),a.closePath(),a.stroke();return a.restore(),b.length},drawCounts:function(a,b){a.save(),a.fillStyle="#fff",a.font="10pt Helvetica",a.fillText("Particles: "+b.particles,10,20),a.fillText("Edges: "+b.edges,10,40),a.fillText("Forces: "+b.forces,10,60),a.fillText("Constraints: "+b.constraints,10,80),a.restore()},drawFPS:function(a,b){var c="FPS: "+b.fps;a.save(),a.fillStyle="#fff",a.font="10pt Helvetica",a.fillText(c,10,120),a.restore()}},a.Renderer=b}("undefined"==typeof exports?this.Newton=this.Newton||{}:exports),function(a){"use strict";function b(a){for(var b,c=["webgl","experimental-webgl","webkit-3d","moz-webgl"],d=0;!b&&d++<c.length;)try{b=a.getContext(c[d])}catch(e){}return b}function c(a,b,c){var d=a.createShader(a.VERTEX_SHADER),e=a.createShader(a.FRAGMENT_SHADER);if(a.shaderSource(d,b),a.shaderSource(e,c),a.compileShader(d),a.compileShader(e),!a.getShaderParameter(d,a.COMPILE_STATUS))throw console.error("error compiling VS shaders:",a.getShaderInfoLog(d)),new Error("shader failure");if(!a.getShaderParameter(e,a.COMPILE_STATUS))throw console.error("error compiling FS shaders:",a.getShaderInfoLog(e)),new Error("shader failure");var f=a.createProgram();return a.attachShader(f,d),a.attachShader(f,e),a.linkProgram(f),f}function d(a,b){b=b||128;var c=document.createElement("canvas");c.width=c.height=b;var d=c.getContext("2d"),f=.5*b;return d.beginPath(),d.arc(f,f,f,0,2*Math.PI,!1),d.closePath(),d.fillStyle="#fff",d.fill(),e(a,c)}function e(a,b){var c=a.createTexture();return a.bindTexture(a.TEXTURE_2D,c),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,b),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.generateMipmap(a.TEXTURE_2D),a.bindTexture(a.TEXTURE_2D,null),c}function f(a){return this instanceof f?(this.el=a,this.width=a.width,this.height=a.height,this.gl=b(a),this.vertices=[],this.sizes=[],this.vArray=new Float32Array(3*f.MAX_PARTICLES),this.sArray=new Float32Array(f.MAX_PARTICLES),this.callback=this.callback.bind(this),this.gl.viewport(0,0,this.width,this.height),this.viewportArray=new Float32Array([this.width,this.height]),this.initShaders(),this.initBuffers(),this.particleTexture=d(this.gl),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE),this.gl.enable(this.gl.BLEND),void 0):new f(a)}var g=["uniform vec2 viewport;","attribute vec3 position;","attribute float size;","void main() {","vec2 scaled = ((position.xy / viewport) * 2.0) - 1.0;","vec2 flipped = vec2(scaled.x, -scaled.y);","gl_Position = vec4(flipped, 0, 1);","gl_PointSize = size + 1.0;","}"].join("\n"),h=["uniform vec2 viewport;","attribute vec3 position;","void main() {","vec2 scaled = ((position.xy / viewport) * 2.0) - 1.0;","vec2 flipped = vec2(scaled.x, -scaled.y);","gl_Position = vec4(flipped, 0, 1);","}"].join("\n"),i=["precision mediump float;","uniform sampler2D texture;","void main() {","gl_FragColor = texture2D(texture, gl_PointCoord);","}"].join("\n"),j=["void main() {","gl_FragColor = vec4(0.0, 0.5, 1.0, 1.0);","}"].join("\n"),k=["void main() {","gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);","}"].join("\n");f.MAX_PARTICLES=1e4,f.prototype={initShaders:function(){var a=this.gl;this.particleShader=c(a,g,i),this.particleShader.uniforms={viewport:a.getUniformLocation(this.particleShader,"viewport")},this.particleShader.attributes={position:a.getAttribLocation(this.particleShader,"position"),size:a.getAttribLocation(this.particleShader,"size")},a.useProgram(this.particleShader),a.uniform2fv(this.particleShader.uniforms.viewport,this.viewportArray),this.edgeShader=c(a,h,k),this.edgeShader.uniforms={viewport:a.getUniformLocation(this.edgeShader,"viewport")},this.edgeShader.attributes={position:a.getAttribLocation(this.edgeShader,"position")},a.useProgram(this.edgeShader),a.uniform2fv(this.edgeShader.uniforms.viewport,this.viewportArray),this.constraintShader=c(a,h,j),this.constraintShader.uniforms={viewport:a.getUniformLocation(this.constraintShader,"viewport")},this.constraintShader.attributes={position:a.getAttribLocation(this.constraintShader,"position")},a.useProgram(this.constraintShader),a.uniform2fv(this.constraintShader.uniforms.viewport,this.viewportArray)},initBuffers:function(){var a=this.gl;this.particlePositionBuffer=a.createBuffer(),this.particleSizeBuffer=a.createBuffer(),this.edgePositionBuffer=a.createBuffer()},callback:function(a,b){this.clear(a),this.drawParticles(b.particles),this.drawEdges(b.edges),this.drawConstraints(b.constraints)},clear:function(){var a=this.gl;a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT)},drawForces:function(b,c){b.save(),b.lineWidth=2,b.strokeStyle="rgba(255, 255, 255, 0.25)",b.fillStyle="rgba(255, 255, 255, 0.15)";for(var d=0,e=c.length;e>d;d++){var f=c[d];f instanceof a.RadialGravity&&(b.beginPath(),b.arc(f.x,f.y,f.strength*f.strength*.5,0,2*Math.PI,!1),b.fill())}b.restore()},drawParticles:function(a){var b=this.gl,c=this.vertices,d=this.sizes;c.length=0,d.length=0;for(var e,f=0,g=a.length;g>f;f++)e=a[f],c.push(e.position.x,e.position.y,0),d.push(e.size<8?e.size:8);if(c.length>this.vArray.length)throw new Error("vArray too small to hold vertices");if(this.vArray.set(c,0),d.length>this.sArray.length)throw new Error("sArray too small to hold sizes");this.sArray.set(d,0),b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,this.particleTexture),b.useProgram(this.particleShader),b.bindBuffer(b.ARRAY_BUFFER,this.particlePositionBuffer),b.bufferData(b.ARRAY_BUFFER,this.vArray,b.STATIC_DRAW),b.vertexAttribPointer(this.particleShader.attributes.position,3,b.FLOAT,!1,0,0),b.enableVertexAttribArray(this.particleShader.attributes.position),b.bindBuffer(b.ARRAY_BUFFER,this.particleSizeBuffer),b.bufferData(b.ARRAY_BUFFER,this.sArray,b.STATIC_DRAW),b.vertexAttribPointer(this.particleShader.attributes.size,1,b.FLOAT,!1,0,0),b.enableVertexAttribArray(this.particleShader.attributes.size),b.drawArrays(b.POINTS,0,c.length/3)
},drawConstraints:function(a){for(var b,c,d=this.gl,e=[],f=0,g=a.length;g>f;f++)b=a[f],"linear"===b.category&&(c=b.getCoords(),e.push(c.x1,c.y1,0),e.push(c.x2,c.y2,0));d.useProgram(this.constraintShader),d.bindBuffer(d.ARRAY_BUFFER,this.edgePositionBuffer),d.bufferData(d.ARRAY_BUFFER,new Float32Array(e),d.STATIC_DRAW),d.vertexAttribPointer(this.constraintShader.attributes.position,3,d.FLOAT,!1,0,0),d.enableVertexAttribArray(this.constraintShader.attributes.position),d.lineWidth(1),d.drawArrays(d.LINES,0,e.length/3)},drawEdges:function(a){for(var b,c=this.gl,d=[],e=0,f=a.length;f>e;e++)b=a[e].getCoords(),d.push(b.x1,b.y1,0),d.push(b.x2,b.y2,0);c.useProgram(this.edgeShader),c.bindBuffer(c.ARRAY_BUFFER,this.edgePositionBuffer),c.bufferData(c.ARRAY_BUFFER,new Float32Array(d),c.STATIC_DRAW),c.vertexAttribPointer(this.edgeShader.attributes.position,3,c.FLOAT,!1,0,0),c.enableVertexAttribArray(this.edgeShader.attributes.position),c.lineWidth(3),c.drawArrays(c.LINES,0,d.length/3)},drawCounts:function(a,b){a.save(),a.fillStyle="#fff",a.font="10pt Helvetica",a.fillText("Particles: "+b.particles,10,20),a.fillText("Edges: "+b.edges,10,40),a.fillText("Forces: "+b.forces,10,60),a.fillText("Constraints: "+b.constraints,10,80),a.restore()},drawFPS:function(a){var b="FPS: "+a.fps;ctx.save(),ctx.fillStyle="#fff",ctx.font="10pt Helvetica",ctx.fillText(b,10,120),ctx.restore()}},a.GLRenderer=f}("undefined"==typeof exports?this.Newton=this.Newton||{}:exports);